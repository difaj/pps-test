<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pay Stars</title>
    <script src="https://a-telegram.stel.com/js/telegram-web-app.js"></script>
    <style>
        :root{
            --glass-bg-dark:rgba(18,18,18,0.85);
            --glass-bg-light:rgba(255,255,255,0.88);
            --glass-border-dark:rgba(255,255,255,0.35);
            --glass-border-light:rgba(0,0,0,0.25);
            --glass-shadow-dark:0 12px 32px rgba(0,0,0,0.55),0 0 0 1px rgba(255,255,255,0.1);
            --glass-shadow-light:0 12px 32px rgba(0,0,0,0.22),0 0 0 1px rgba(0,0,0,0.08);
            --glass-blur:8px;
            --bg-pattern-dark:url('https://i.ibb.co/Q7s6vJh4/image.png');
            --bg-pattern-light:url('https://i.ibb.co/zWYJtrDG/image.png');
        }
        body{
            margin:0;padding:0;
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
            background:var(--tg-theme-bg-color,#121212);
            color:var(--tg-theme-text-color,#fff);
            min-height:100vh;display:flex;flex-direction:column;
            transition:background-color .3s ease,color .3s ease;
            overflow-x:hidden;touch-action:pan-y;
            background-image:var(--bg-pattern-dark);
            background-size:300px;background-repeat:repeat;
            background-attachment:fixed;background-position:center;
        }
        body.light-theme{
            background-image:var(--bg-pattern-light);
            color:#000;
        }
        .container{
            text-align:center;animation:fadeIn 1s ease-in-out;
            width:100%;max-width:500px;margin:0 auto;
            padding:40px 20px 100px;box-sizing:border-box;flex-grow:1;
            position:relative;z-index:1;
        }
        h1{
            font-size:2rem;margin-bottom:50px;
            color:var(--tg-theme-button-color,#bb86fc);
            text-shadow:0 2px 8px rgba(0,0,0,.5);font-weight:700;
        }
        body.light-theme h1{
            color:#6200ea;text-shadow:0 2px 8px rgba(0,0,0,.2);
        }
        .links{
            display:flex;flex-direction:column;gap:18px;
            list-style:none;padding:0;width:100%;max-width:400px;margin:0 auto;
        }
        .links li{display:flex;justify-content:center;}

        /* РІДКЕ СКЛО — ФОН + ЕФЕКТ, ТЕКСТ ЧІТКИЙ */
        .liquidGlass-wrapper{
            position:relative;display:flex;justify-content:center;align-items:center;
            font-weight:600;overflow:hidden;
            border-radius:20px;
            box-shadow:0 6px 6px rgba(0,0,0,0.2),0 0 20px rgba(0,0,0,0.1);
            transition:all .4s cubic-bezier(.175,.885,.32,2.2);
            cursor:pointer;
            width:100%;max-width:300px;box-sizing:border-box;
            padding:16px 28px;
            backdrop-filter:blur(3px);
            -webkit-backdrop-filter:blur(3px);
        }
        .liquidGlass-effect{
            position:absolute;z-index:0;inset:0;
            filter:url(#glass-distortion);
            opacity:0.7;
        }
        .liquidGlass-tint{
            z-index:1;position:absolute;inset:0;
            background:rgba(255,255,255,.4);
        }
        .liquidGlass-shine{
            position:absolute;inset:0;z-index:2;
            overflow:hidden;
            box-shadow:inset 2px 2px 1px 0 rgba(255,255,255,.5),
                        inset -1px -1px 1px 1px rgba(255,255,255,.5);
        }
        .liquidGlass-text{
            z-index:3;position:relative;
            font-size:1.1rem;font-weight:600;
            color:#fff;
            text-shadow:0 1px 2px rgba(0,0,0,.8);
            filter:none !important;
            -webkit-filter:none !important;
        }
        body.light-theme .liquidGlass-text{
            color:#000;
            text-shadow:0 1px 2px rgba(0,0,0,.4);
        }
        .liquidGlass-wrapper:hover{
            transform:translateY(-2px);
            box-shadow:0 10px 20px rgba(0,0,0,.3),0 0 30px rgba(187,134,252,.4);
        }
        .liquidGlass-wrapper:active{
            transform:translateY(1px);
        }

        /* СВІТЛА ТЕМА */
        body.light-theme .liquidGlass-wrapper{
            box-shadow:0 6px 6px rgba(0,0,0,.15),0 0 20px rgba(0,0,0,.08);
        }
        body.light-theme .liquidGlass-tint{
            background:rgba(0,0,0,.1);
        }
        body.light-theme .liquidGlass-shine{
            box-shadow:inset 2px 2px 1px 0 rgba(0,0,0,.1),
                        inset -1px -1px 1px 1px rgba(0,0,0,.08);
        }

        /* НАВІГАЦІЙНИЙ БАР — МАЛЕНЬКІ КНОПКИ */
        .nav-bar{
            position:fixed;bottom:0;left:0;right:0;z-index:1000;
            display:flex;padding:6px 10px;
            background:transparent;
            width:100%;max-width:500px;margin:0 auto;
            box-sizing:border-box;overflow-x:auto;overflow-y:hidden;
            white-space:nowrap;scrollbar-width:none;
            -ms-overflow-style:none;-webkit-overflow-scrolling:touch;
            touch-action:pan-x;scroll-behavior:smooth;
            -webkit-user-select:none;user-select:none;
            gap:6px;
            backdrop-filter:blur(8px);
            -webkit-backdrop-filter:blur(8px);
        }
        .nav-bar::-webkit-scrollbar{display:none;}

        .nav-bar .liquidGlass-wrapper{
            width:auto;min-width:70px;max-width:none;
            padding:10px 14px;
            border-radius:16px;
            font-size:.85rem;
        }
        .nav-bar .liquidGlass-text{
            font-size:.85rem;
            text-shadow:0 1px 2px rgba(0,0,0,.6);
        }
        body.light-theme .nav-bar .liquidGlass-text{
            text-shadow:0 1px 1px rgba(0,0,0,.3);
        }

        .search-container{
            display:flex;flex-direction:row;align-items:center;gap:12px;
            margin-bottom:20px;flex-wrap:nowrap;
        }
        .search-input{
            padding:14px;font-size:16px;border:1px solid var(--glass-border-dark);
            border-radius:20px;background:var(--glass-bg-dark);
            backdrop-filter:blur(var(--glass-blur));
            -webkit-backdrop-filter:blur(var(--glass-blur));
            color:var(--tg-theme-text-color,#fff);width:100%;
            max-width:120px;box-sizing:border-box;
            box-shadow:var(--glass-shadow-dark);
        }
        body.light-theme .search-input{
            background:var(--glass-bg-light);border-color:var(--glass-border-light);
            box-shadow:var(--glass-shadow-light);color:#000;
        }
        .search-btn{max-width:100px;}

        .scan-history,.nft-result,.no-history,.no-result{
            margin:25px 0;padding:20px;border-radius:20px;
            background:var(--glass-bg-dark);
            border:1px solid var(--glass-border-dark);
            backdrop-filter:blur(var(--glass-blur));
            -webkit-backdrop-filter:blur(var(--glass-blur));
            box-shadow:var(--glass-shadow-dark);text-align:center;
        }
        body.light-theme .scan-history,
        body.light-theme .nft-result,
        body.light-theme .no-history,
        body.light-theme .no-result{
            background:var(--glass-bg-light);border-color:var(--glass-border-light);
            box-shadow:var(--glass-shadow-light);
        }

        .clear-history-btn{margin-top:15px;}
        .tg-logo{
            margin-top:30px;opacity:.7;font-size:.8rem;
            color:var(--tg-theme-hint-color,#aaa);
        }
        body.light-theme .tg-logo{color:#666;}

        .page{display:none;}
        .page.active{display:block;}

        @keyframes fadeIn{
            from{opacity:0;transform:translateY(10px);}
            to{opacity:1;transform:translateY(0);}
        }

        html,body{-webkit-overflow-scrolling:touch;}
        input,textarea,select{font-size:16px;}
        .status-feedback{display:none;}
    </style>
</head>
<body>
    <!-- SVG ФІЛЬТР — ТІЛЬКИ ДЛЯ ФОНУ -->
    <svg style="display: none">
      <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%" filterUnits="objectBoundingBox">
        <feTurbulence type="fractalNoise" baseFrequency="0.01 0.01" numOctaves="1" seed="5" result="turbulence"/>
        <feComponentTransfer in="turbulence" result="mapped">
          <feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5"/>
          <feFuncG type="gamma" amplitude="0" exponent="1" offset="0"/>
          <feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5"/>
        </feComponentTransfer>
        <feGaussianBlur in="turbulence" stdDeviation="3" result="softMap"/>
        <feSpecularLighting in="softMap" surfaceScale="5" specularConstant="1" specularExponent="100" lighting-color="white" result="specLight">
          <fePointLight x="-200" y="-200" z="300"/>
        </feSpecularLighting>
        <feComposite in="specLight" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litImage"/>
        <feDisplacementMap in="SourceGraphic" in2="softMap" scale="150" xChannelSelector="R" yChannelSelector="G"/>
      </filter>
    </svg>

    <div class="container">
        <div class="page active" id="main-page">
            <h1>Pay Stars</h1>
            <ul class="links">
                <li>
                    <div class="liquidGlass-wrapper" onclick="PayStarsApp.openLink('https://t.me/stars_telegram_vf')" data-haptic="warning">
                        <div class="liquidGlass-effect"></div>
                        <div class="liquidGlass-tint"></div>
                        <div class="liquidGlass-shine"></div>
                        <div class="liquidGlass-text">Our Channel</div>
                    </div>
                </li>
                <li>
                    <div class="liquidGlass-wrapper" onclick="PayStarsApp.openLink('https://t.me/StarsPremiumBot')" data-haptic="warning">
                        <div class="liquidGlass-effect"></div>
                        <div class="liquidGlass-tint"></div>
                        <div class="liquidGlass-shine"></div>
                        <div class="liquidGlass-text">Premium for Stars</div>
                    </div>
                </li>
            </ul>
            <div class="tg-logo">Telegram WebApp</div>
        </div>

        <div class="page" id="contact-page">
            <h1>Contact Us</h1>
            <ul class="links">
                <li><div class="liquidGlass-wrapper" onclick="PayStarsApp.openLink('https://t.me/lakel')" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Contact Admin</div></div></li>
                <li><div class="liquidGlass-wrapper" onclick="PayStarsApp.openLink('https://t.me/help_stars')" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Feedback</div></div></li>
            </ul>
            <div class="tg-logo">Telegram WebApp</div>
        </div>

        <div class="page" id="scan-history-page">
            <h1>Scan History</h1>
            <div class="scan-history" id="scan-history-table" style="display:none;"><table><thead><tr><th>Date</th><th>Result</th></tr></thead><tbody id="scan-history-list"></tbody></table></div>
            <div class="no-history" id="no-history-message">You don't have any scan history yet.</div>
            <div class="liquidGlass-wrapper clear-history-btn" onclick="PayStarsApp.clearScanHistory()" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Clear Scan History</div></div>
            <div class="tg-logo">Telegram WebApp</div>
        </div>

        <div class="page" id="nft-search-page">
            <h1>Search NFT Gifts</h1>
            <div class="search-container">
                <input type="text" id="nft-name-input" placeholder="Name" class="search-input glass">
                <input type="text" id="nft-number-input" placeholder="Number" class="search-input glass">
                <div class="liquidGlass-wrapper search-btn" onclick="PayStarsApp.searchNFT()" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Search</div></div>
            </div>
            <div class="nft-result glass" id="nft-result" style="display:none;"><img id="nft-image" alt="NFT Image" style="max-width:100%;border-radius:16px;margin:12px 0;display:none;"><div id="no-image-message" style="display:none;">Photo not available</div><table class="nft-table"><tbody id="nft-info"></tbody></table></div>
            <div class="no-result glass" id="no-result-message">Enter an NFT name and number to search.</div>
            <div class="tg-logo">Telegram WebApp</div>
        </div>

        <div class="page" id="test-page">
            <h1>Test Features</h1>
            <ul class="links">
                <li><div class="liquidGlass-wrapper" onclick="PayStarsApp.openLink('tg://nft?slug=aTCuqOAvWUsBAAAAj08P-4gBdtw')" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Test Button</div></div></li>
                <li><div class="liquidGlass-wrapper" onclick="PayStarsApp.openLink('https://t.me/$qEkvAY4AKEoGAAAA4lfaNB2EbVk')" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Make a Payment</div></div></li>
                <li><div class="liquidGlass-wrapper" onclick="PayStarsApp.setEmojiStatus(this,'5258115417230016513');" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Set Emoji Status</div></div></li>
                <li><div class="liquidGlass-wrapper" onclick="PayStarsApp.toggleTheme()" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Toggle Theme</div></div></li>
            </ul>
            <div class="tg-logo">Telegram WebApp</div>
        </div>
    </div>

    <!-- НИЖНЯ ПАНЕЛЬ — МАЛЕНЬКІ, ЧІТКІ КНОПКИ -->
    <div class="nav-bar" id="nav-bar">
        <div class="liquidGlass-wrapper" data-page="main-page"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Main</div></div>
        <div class="liquidGlass-wrapper" data-page="contact-page"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Contact</div></div>
        <div class="liquidGlass-wrapper" data-page="scan-history-page"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">History</div></div>
        <div class="liquidGlass-wrapper" data-page="nft-search-page"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">NFT</div></div>
        <div class="liquidGlass-wrapper" onclick="PayStarsApp.showScanQrPopup(true);" data-haptic="warning"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">QR Scan</div></div>
        <div class="liquidGlass-wrapper" data-page="test-page"><div class="liquidGlass-effect"></div><div class="liquidGlass-tint"></div><div class="liquidGlass-shine"></div><div class="liquidGlass-text">Test</div></div>
    </div>

    <script>
        const PayStarsApp={initDone:false,webApp:null,currentPage:'main-page',userId:null,
            init:function(){
                if(this.initDone)return true;
                if(window.Telegram&&window.Telegram.WebApp){
                    this.webApp=Telegram.WebApp;
                    this.webApp.ready();this.webApp.expand();this.initDone=true;
                    const user=this.webApp.initDataUnsafe?.user;
                    if(user)this.userId=user.id;
                    if(window.location.search)history.replaceState({},'',window.location.pathname);
                    const systemTheme=this.webApp.colorScheme||'dark';
                    const isLight=systemTheme==='light';
                    document.body.classList.toggle('light-theme',isLight);
                    this.applyTelegramTheme(isLight);
                    const navBar=document.getElementById('nav-bar');
                    if(navBar){
                        let startX=0,startScroll=0;
                        navBar.addEventListener('touchstart',e=>{
                            if(e.touches.length===1){
                                startX=e.touches[0].clientX;
                                startScroll=navBar.scrollLeft;
                            }
                        },{passive:true});
                        navBar.addEventListener('touchmove',e=>{
                            if(e.touches.length===1){
                                const delta=startX-e.touches[0].clientX;
                                navBar.scrollLeft=startScroll+delta;
                                e.preventDefault();
                            }
                        },{passive:false});
                        navBar.addEventListener('touchend',()=>{startX=0;startScroll=0;});
                    }
                    return true;
                }
                return false;
            },
            applyTelegramTheme:function(isLight){
                const colors=isLight?{bg:'#ffffff',text:'#000000',button:'#6200ea',buttonText:'#ffffff',secondary:'rgba(0,0,0,0.08)',hint:'#666666'}:{bg:'#121212',text:'#ffffff',button:'#bb86fc',buttonText:'#ffffff',secondary:'rgba(255,255,255,0.08)',hint:'#aaaaaa'};
                Object.entries(colors).forEach(([k,v])=>{
                    const p=`--tg-theme-${k==='bg'?'bg-color':k==='secondary'?'secondary-bg-color':k==='buttonText'?'button-text-color':k==='button'?'button-color':k==='hint'?'hint-color':'text-color'}`;
                    document.body.style.setProperty(p,v);
                });
                document.body.style.backgroundImage=isLight?'var(--bg-pattern-light)':'var(--bg-pattern-dark)';
            },
            openLink:function(url){
                if(!this.init())return;
                this.webApp.HapticFeedback.impactOccurred('light');
                try{this.webApp.openLink(url);}catch(e){window.location.href=url;}
            },
            setEmojiStatus:function(el,id){
                if(!this.init())return;
                if(!this.webApp.isVersionAtLeast('8.0'))return;
                this.webApp.HapticFeedback.impactOccurred('light');
                try{this.webApp.setEmojiStatus(id,null,s=>this.webApp.HapticFeedback.notificationOccurred(s?'success':'error'));}catch(e){}
            },
            showScanQrPopup:function(links){
                if(!this.init()||!this.webApp.isVersionAtLeast('6.7'))return;
                this.webApp.HapticFeedback.impactOccurred('light');
                try{
                    this.webApp.showScanQrPopup({text:links?'Scan link QR':'Scan QR'},res=>{
                        this.webApp.closeScanQrPopup();
                        if(links&&res.startsWith('http'))this.openLink(res);
                        this.saveScanHistory(res);
                        if(this.currentPage==='scan-history-page')this.showScanHistory();
                        return true;
                    });
                }catch(e){}
            },
            saveScanHistory:function(res){
                if(!this.userId)return;
                const k=`scan_history_${this.userId}`;
                this.webApp.DeviceStorage.getItem(k,(e,v)=>{
                    let h=[];if(!e&&v)try{const p=JSON.parse(v);if(Array.isArray(p))h=p;}catch(e){}
                    h.push({timestamp:new Date().toISOString(),result:res});
                    this.webApp.DeviceStorage.setItem(k,JSON.stringify(h),()=>{});
                });
            },
            showScanHistory:function(){
                if(!this.userId)return;
                const k=`scan_history_${this.userId}`;
                const t=document.getElementById('scan-history-table');
                const l=document.getElementById('scan-history-list');
                const m=document.getElementById('no-history-message');
                l.innerHTML='';
                this.webApp.DeviceStorage.getItem(k,(e,v)=>{
                    if(e||!v||!Array.isArray(JSON.parse(v||'[]'))||(JSON.parse(v||'[]')).length===0){
                        t.style.display='none';m.style.display='block';return;
                    }
                    try{
                        const h=JSON.parse(v);
                        t.style.display='block';m.style.display='none';
                        h.forEach(i=>{
                            if(i.timestamp&&i.result){
                                const d=new Date(i.timestamp);
                                const fd=`${d.getUTCDate().toString().padStart(2,'0')}.${(d.getUTCMonth()+1).toString().padStart(2,'0')}.${d.getUTCFullYear()}`;
                                const ft=`${d.getUTCHours().toString().padStart(2,'0')}:${d.getUTCMinutes().toString().padStart(2,'0')}:${d.getUTCSeconds().toString().padStart(2,'0')}`;
                                const tr=document.createElement('tr');
                                tr.innerHTML=`<td><div class="date-time">${fd}<br>${ft}</div></td><td>${i.result}</td>`;
                                l.appendChild(tr);
                            }
                        });
                    }catch(e){t.style.display='none';m.style.display='block';}
                });
            },
            clearScanHistory:function(){
                if(!this.userId)return;
                this.webApp.showConfirm('Clear history?',c=>{if(c)this.webApp.DeviceStorage.removeItem(`scan_history_${this.userId}`,()=>this.showScanHistory());});
            },
            searchNFT:async function(){
                if(!this.init())return;
                const n=document.getElementById('nft-name-input').value.trim();
                const num=document.getElementById('nft-number-input').value.trim();
                const msg=document.getElementById('no-result-message');
                if(!n||!num){msg.style.display='block';return;}
                const input=`${n}-${num}`;
                const res=document.getElementById('nft-result');
                const info=document.getElementById('nft-info');
                const img=document.getElementById('nft-image');
                const noImg=document.getElementById('no-image-message');
                res.style.display='none';msg.style.display='block';msg.textContent='Searching...';
                img.style.display='none';noImg.style.display='none';
                let loaded=false;const max=3;let a=0;
                while(a<max){
                    try{
                        const p='https://api.allorigins.win/raw?url=';
                        const u=`${p}${encodeURIComponent(`https://a-ttgme.stel.com/nft/${input}`)}`;
                        const iurl=`https://tnft.stel.com/gift/${n}-${num}.webp`;
                        await new Promise(r=>{
                            img.src=iurl;img.onload=()=>{loaded=true;r();};
                            img.onerror=()=>{loaded=false;r();};
                            setTimeout(r,5000);
                        });
                        const r=await fetch(u,{headers:{'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36','Referer':'https://a-ttgme.stel.com/'}});
                        if(!r.ok)throw new Error(`HTTP ${r.status}`);
                        const t=await r.text();
                        const d=new DOMParser().parseFromString(t,'text/html');
                        const tbl=d.querySelector('.tgme_gift_table');
                        if(!tbl)throw new Error('No data');
                        const data={};
                        tbl.querySelectorAll('tr').forEach(row=>{
                            const th=row.querySelector('th')?.textContent.trim();
                            const td=row.querySelector('td');
                            if(th&&td){
                                if(th==='Owner'){
                                    const clone=td.cloneNode(true);
                                    clone.querySelector('.tgme_gift_owner_photo')?.remove();
                                    const link=clone.querySelector('a');
                                    const name=link?link.textContent.trim():clone.textContent.trim()||'Anonymous';
                                    if(link){
                                        const h=link.getAttribute('href');
                                        data[th]=`<span class="cat-avatar">User</span><a href="${h}" onclick="PayStarsApp.openLink('${h}');return false;">${name}</a>`;
                                    }else data[th]=`<span class="cat-avatar">User</span>${name}`;
                                }else data[th]=td.innerHTML.trim();
                            }
                        });
                        data['Model']='Choco Dream <span class="percent-bubble">15%</span>';
                        data['Backdrop']='French Blue <span class="percent-bubble">1.8%</span>';
                        data['Symbol']='Pig <span class="percent-bubble">30%</span>';
                        info.innerHTML=`
                            <tr><th>Owner</th><td>${data['Owner']||'<span class="cat-avatar">User</span>Anonymous'}</td></tr>
                            <tr><th>Model</th><td>${data['Model']||'N/A'}</td></tr>
                            <tr><th>Backdrop</th><td>${data['Backdrop']||'N/A'}</td></tr>
                            <tr><th>Symbol</th><td>${data['Symbol']||'N/A'}</td></tr>
                            <tr><th>Quantity</th><td>${data['Quantity']||'N/A'}</td></tr>
                        `;
                        res.style.display='block';msg.style.display='none';
                        document.getElementById('nft-name-input').value='';
                        document.getElementById('nft-number-input').value='';
                        img.style.display=loaded?'block':'none';
                        this.webApp.HapticFeedback.notificationOccurred('success');
                        return;
                    }catch(e){
                        a++;if(a>=max){
                            msg.textContent='Not found or connection error';
                            res.style.display='block';
                            this.webApp.HapticFeedback.notificationOccurred('error');
                        }else await new Promise(r=>setTimeout(r,1000*a));
                    }
                }
            },
            switchPage:function(id){
                document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
                const pg=document.getElementById(id);if(pg)pg.classList.add('active');
                document.querySelectorAll('.nav-bar .liquidGlass-wrapper').forEach(l=>l.classList.remove('active'));
                const nl=document.querySelector(`.nav-bar .liquidGlass-wrapper[data-page="${id}"]`);if(nl)nl.classList.add('active');
                this.currentPage=id;
                this.webApp.HapticFeedback.impactOccurred('light');
                history.pushState({page:id},'',window.location.pathname);
                if(id==='scan-history-page')this.showScanHistory();
            },
            toggleTheme:function(){
                if(!this.init())return;
                const isLight=document.body.classList.toggle('light-theme');
                this.applyTelegramTheme(isLight);
                this.webApp.HapticFeedback.impactOccurred('light');
                if(this.userId)this.webApp.DeviceStorage.setItem(`theme_${this.userId}`,isLight?'light':'dark',()=>{});
            },
            setupHapticFeedback:function(){
                document.querySelectorAll('[data-haptic]').forEach(el=>el.addEventListener('click',()=>{if(this.webApp)this.webApp.HapticFeedback.notificationOccurred(el.dataset.haptic);}));
            },
            setupNavigation:function(){
                document.querySelectorAll('.nav-bar .liquidGlass-wrapper').forEach(b=>{
                    b.removeEventListener('click',b._handler);
                    if(b.dataset.page){b._handler=()=>this.switchPage(b.dataset.page);}
                    else{b._handler=()=>b.onclick();}
                    b.addEventListener('click',b._handler);
                    b.addEventListener('contextmenu',e=>e.preventDefault());
                });
            },
            setupButtonContextMenuPrevention:function(){
                document.querySelectorAll('.links .liquidGlass-wrapper, .clear-history-btn').forEach(b=>b.addEventListener('contextmenu',e=>e.preventDefault()));
            }
        };
        window.addEventListener('popstate',e=>PayStarsApp.switchPage(e.state?.page||'main-page'));
        document.addEventListener('DOMContentLoaded',()=>{
            PayStarsApp.init();
            PayStarsApp.setupHapticFeedback();
            PayStarsApp.setupNavigation();
            PayStarsApp.setupButtonContextMenuPrevention();
            PayStarsApp.switchPage('main-page');
            document.querySelector('.nav-bar .liquidGlass-wrapper[data-page="main-page"]').classList.add('active');
            document.addEventListener('gesturestart',e=>e.preventDefault());
            document.addEventListener('touchmove',e=>{if(e.scale!==1)e.preventDefault();},{passive:false});
        });
    </script>
</body>
</html>
